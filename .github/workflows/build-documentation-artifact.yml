# This is a workflow to build the MusicFormats documentation and create an artifact of it

name: Build the MusicFormats documentation

# runs:
#   using: 'node20'
#   main: 'main.js'

# Controls when the action will run.
on:
  # Triggers the workflow on push or pull request events but only for the master branch
  push:
    branches: [ master ]
  pull_request:
    branches: [ master ]

  # Allows you to run this workflow manually from the Actions tab
  workflow_dispatch:

# A workflow run is made up of one or more jobs that can run sequentially or in parallel
jobs:
  compile-user-guide:
    name: Compile user guide
    runs-on: ubuntu-latest

    steps:
      # Checks-out your repository under $GITHUB_WORKSPACE, so your job can access it
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
        with:
          node-version: '20'

      - name: Compile user guide
        uses: xu-cheng/latex-action@v3
#         with:
#           work_in_root_file_dir: documentation
#           root_file: documentation/foo.tex
#           root_file: MusicFormatsUserGuide.tex
        run:
#           shell: bash FOO
#           working-directory: build
#           cd build; cmake --build .
          cd documentation ; pwd ; uname -a ; pdflatex foo.tex ; ls -salR

      - name: Upload user guide
        uses: actions/upload-artifact@v4
        with:
          name: musicformats-documentation-artifact
          path: foo.pdf
#           path: MusicFormatsUserGuide.pdf
          retention-days: 1


#   upload-user-guide:
#     name: Upload user guide
#     runs-on: macos-latest
#     needs: compile-user-guide
#
#   steps:
# #     - name: Download Artifact
# #       uses: actions/download-artifact@v2
# #       with:
# #         name: drive-pdf
# #
# #     - name: Upload to Google Drive
# #       uses: satackey/action-google-drive@v1
# #       with:
# #         skicka-tokencache-json: ${{ secrets.SKICKA_TOKENCACHE_JSON }}
# #         upload-from: ./<TEX-FILENAME>.pdf
# #         upload-to: /<GOOGLE DRIVE FOLDER PATH>
# #
# #         google-client-id: ${{ secrets.GOOGLE_CLIENT_ID }}
# #         google-client-secret: ${{ secrets.GOOGLE_CLIENT_SECRET }}
#
#     - name: Upload libraries and executables for MacOS
#       uses: actions/upload-artifact@v4
#       with:
#         name: musicformats-macos-latest-artifact
#         path: |
#           MusicFormatsVersionNumber.txt
#           MusicFormatsVersionDate.txt
# #             build/bin
# #             build/lib
# #             build/Makefile
# #           documentation/IntroductionToMusicXML/IntroductionToMusicXML.pdf
#           documentation/mfuserguide/MusicFormatsUserGuide.pdf
# #           documentation/mfmaintainanceguide/MusicFormatsFigures.pdf
# #           documentation/mfmaintainanceguide/MusicFormatsMaintainanceGuide.pdf
# #           documentation/mfapiguide/MusicFormatsAPIGuide.pdf
#
#           # uncomment to have the full libdir in the .zip archive
#           build/libdir
