% !TEX root = MusicFormatsCLIUserGuide.tex

% -------------------------------------------------------------------------
\chapter{Shell basics}
% -------------------------------------------------------------------------

Since this document is about using \mf\ from the \CLI\ by musicians, let's start by a short presentation of shell usage. This chapter can be skipped of course by shell-savvy users.

A \shell\ is an application that reads commands and executes them. In the early ages of physical \MainIt{terminal}s, they were typically typed on a keyboard. With \GUI\ nowadays, they can be typed in a so-called terminal window.
A 

The syntax of shell commands is meant to be simple, without complex structuring features such as those found in programming languages.

A number of shell have been used over the years. Most of the ones used at the time of this writing belong to the \code{sh} family, among then \bash\ and \zsh\ (\code{zsh}. The commands we use in this document can be run on any shell in this family.

%%%JMI Shells can also read commands from text files named \MainIt{script}s through input redirection.


% -------------------------------------------------------------------------
\section{Basic shell builtins}
% -------------------------------------------------------------------------

Many builtins have very short names for ease of interactive use. Many vowels were left out to minimize typing. For example, there are:
\begin{itemize}
\item \code{pwd} to show the current working directory;
\item \code{cd} to change directory;
\item \code{echo} to produce output in the terminal window.
\end{itemize}

A so-called \MainIt{prompt} is displayed by a shell when is it ready to read a command and execute it. This document uses two kinds of prompts:
\begin{itemize}
\item one contains only the user name and machine name, such as:
\begin{lstlisting}[language=Terminal]
jacquesmenu@macmini: ~ > 
\end{lstlisting}

\item the other one displays the current working directory: it is used when the latter has to be set at a specific value for the command:
\begin{lstlisting}[language=Terminal]
jacquesmenu@macmini: ~/musicformats-git-dev/files/musicxmlfiles > 
\end{lstlisting}

\end{itemize}

When a shell is launched, a directory is chosen as the current \MainIt{working directory}, usually the user's \MainIt{home directory}.
\begin{lstlisting}[language=Terminal]
jacquesmenu@macmini: ~ > pwd
/Users/jacquesmenu

jacquesmenu@macmini: ~ > cd musicformats-git-dev

jacquesmenu@macmini: ~/musicformats-git-dev > pwd
/Users/jacquesmenu/musicformats-git-dev
jacquesmenu@macmini: ~/musicformats-git-dev >
\end{lstlisting}


% -------------------------------------------------------------------------
\section{Commands}
% -------------------------------------------------------------------------

A command name is either provided by the shell itself, a so-called \MainIt{builtin}, or the name of a piece of software that can be executed.

In this example, the command name is xml2lyy:
\begin{lstlisting}[language=Terminal]
jacquesmenu@macmini > xml2lyy +sdf 45
-bash: xml2lyy: command not found
\end{lstlisting}

The shell can be queried about a command name:
\begin{lstlisting}[language=Terminal]
jacquesmenu@macmini > type cd
cd is a shell builtin

jacquesmenu@macmini > type xml2lyy
-bash: type: xml2lyy: not found

jacquesmenu@macmini > type xml2ly
xml2ly is hashed (/Users/jacquesmenu/musicformats-git-dev/build/bin/xml2ly)
\end{lstlisting}


% -------------------------------------------------------------------------
\section{Paths}
% -------------------------------------------------------------------------

The files on a computer are organized as file-systems. A \fspath\ is a way to access a file on a file system:
\begin{itemize}
\item on \Unix\-like system, there is a single tree of so-called \MainIt{directories}, the root being named \code{/}. A sub-directory is preceded by \code{/} in the paths;
\item on \Windows\ systems, there is a set of trees, their roots being the physical or virtual drives, such as \code{C:}. A \code{\textbackslash} is used to indicate a sub-directory.
\end{itemize}

This document uses \Unix\-like pathes.


% -------------------------------------------------------------------------
\section{Quoting, variables and aliases}\label{Quoting, variables and aliases}
% -------------------------------------------------------------------------

Shell commands are submitted as a sequence of words separated by spaces. If a word, such a file name, contains \MainIt{space}s, it has to be surrounded by \quotes\ or \doubleQuotes\ in order to be seen by the shell as a single word:
\begin{lstlisting}[language=Terminal]
jacquesmenu@macmini > xml2ly Nice file.xml
Several input file names supplied, only one can be used
The arguments vector contains 2 elements:
   0: "Nice"
   1: "file.xml"

jacquesmenu@macmini > xml2ly 'Nice file.xml'
can't open file Nice file.xml
### Conversion from MusicXML to LilyPond failed ###

jacquesmenu@macmini > xml2ly "Nice file.xml"
can't open file Nice file.xml
### Conversion from MusicXML to LilyPond failed ###
\end{lstlisting}

Note that if a quote or double quote is part of word, the word should be inclosed by the other such:
\begin{lstlisting}[language=Terminal]
jacquesmenu@macmini: ~/musicformats-git-dev/files/musicxmlfiles > xml2ly -find "tuplet's"
0 occurrence of string "tuplet's" has been found

jacquesmenu@macmini: ~/musicformats-git-dev/files/musicxmlfiles > 
jacquesmenu@macmini: ~/musicformats-git-dev/files/musicxmlfiles > xml2ly -find 'tuplet"s'
0 occurrence of string "tuplet"s" has been found
\end{lstlisting}

A shell \MainIt{variable} is a name for a piece of text, called its \MainIt{value}, that can be used instead of that text in commands. The value of the variable can be seen in the terminal with the \code{echo} command:
\begin{lstlisting}[language=Terminal]
jacquesmenu@macmini: ~/musicformats-git-dev > DOC_DIR=documentation

jacquesmenu@macmini: ~/musicformats-git-dev > echo $DOC_DIR
documentation
\end{lstlisting}

Variables can be used surrounded by curly brackets, too:
\begin{lstlisting}[language=Terminal]
jacquesmenu@macmini: ~/musicformats-git-dev/documentation > echo ${DOC_DIR}
documentation
\end{lstlisting}
This notation provides further possibilities such as string replacement, which are out of the scope of this document.

Using variables is interesting when there are several uses of its value: changing the value at one place causing the new value to be used at every such use:
\begin{lstlisting}[language=Terminal]
jacquesmenu@macmini: ~/musicformats-git-dev > ls $DOC_DIR
CommonLaTeXFiles		MusicFormatsCLIUserGuide	presentation
IntroductionToMusicXML		MusicFormatsMaintainanceGuide
MusicFormatsAPIUserGuide	graphics

jacquesmenu@macmini: ~/musicformats-git-dev > cd $DOC_DIR

jacquesmenu@macmini: ~/musicformats-git-dev/documentation > pwd
/Users/jacquesmenu/musicformats-git-dev/documentation
\end{lstlisting}

The difference between \quotes\ and \doubleQuotes\ is how variables are handled:
\begin{itemize}
\item the characters between quotes are used literally;
\item variables occurring between \doubleQuotes\ are replaced by their value.
\end{itemize}

\begin{lstlisting}[language=Terminal]
jacquesmenu@macmini: ~/musicformats-git-dev > DOC_DIR=documentation

jacquesmenu@macmini: ~/musicformats-git-dev > cd '$DOC_DIR'
-bash: cd: $DOC_DIR: No such file or directory

jacquesmenu@macmini: ~/musicformats-git-dev > cd "$DOC_DIR"

jacquesmenu@macmini: ~/musicformats-git-dev/documentation > pwd
/Users/jacquesmenu/musicformats-git-dev/documentation
\end{lstlisting}

Here is an example combining quotes and \doubleQuotes:
\begin{lstlisting}[language=Terminal]
jacquesmenu@macmini: ~/musicformats-git-dev/files/musicxmlfiles > DOC_DIR=documentation
jacquesmenu@macmini: ~/musicformats-git-dev/files/musicxmlfiles > echo "DOC_DIR's value is: ${DOC_DIR}"
DOC_DIR's value is: documentation
\end{lstlisting}


% -------------------------------------------------------------------------
\section{Functions}
% -------------------------------------------------------------------------

The shells allow the creation of \MainIt{functions}, that contain several commands under a single name. An example is \function{checkVersions}, which displays the versions of the main \mf\ \service s:
\begin{lstlisting}[language=Terminal]
function checkVersions ()
{
#  set -x

  xml2ly -v
  xml2brl -v
  xml2xml -v
  xml2gmn -v

  Mikrokosmos3Wandering -v

  msdlconverter -v
#  set +x
}
\end{lstlisting}


% -------------------------------------------------------------------------
\section{MusicFormatsBashDefinitions.bash}
% -------------------------------------------------------------------------

\fileName{MusicFormatsBashDefinitions.bash} contains a set of variables, aliases and function definitions used by this author. One of them is \function{checkVersions} above.

Feel free to use them, adapt them or ignore them depending on your taste.

Some settings we use in this document are:
\begin{lstlisting}[language=Terminal]
jacquesmenu@macmini > type ll
ll is a function
ll () 
{ 
    ls -salGTF $*
}
\end{lstlisting}
The options to \code{ls} may vary depending the on the \OS.

