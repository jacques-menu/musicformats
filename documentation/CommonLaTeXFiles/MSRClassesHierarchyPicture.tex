% -------------------------------------------------------------------------
%  MusicFormats Library
%  Copyright (C) Jacques Menu 2016-2023

%  This Source Code Form is subject to the terms of the Mozilla Public
%  License, v. 2.0. If a copy of the MPL was not distributed with this
%  file, you can obtain one at http://mozilla.org/MPL/2.0/.

%  https://github.com/jacques-menu/musicformats
% -------------------------------------------------------------------------

\begin{adjustwidth}{0.5 cm}{0.5 cm}
\begin{figure}[p]

%\floatbox[{\capbeside\thisfloatsetup{capbesideposition={left,top},capbesidewidth=4cm}}]{figure}[\FBwidth]

\caption {The MSR classes hierarchy}

%\begin{sidecaption}[fortoc]{title}[label]
%the body of the float
%\end{sidecaption}

\label{The MSR classes hierarchy}

\tt

\begin{center}


% The sizes
% ------------------------------------------------

\def \bendAngle {60}

\def \minimumRectangleHeight {8.5 mm}
\def \minimumRectangleWidth  {30 mm}

\def \separatorWidth {\minimumRectangleWidth}

\def \roundedCorners {10pt}


% -------------------------------------------------------------------------
\begin{tikzpicture}[
	%
	scale=0.45,
	%
	>=open triangle 45,
	%
	every node/.style={
  	rounded corners=\roundedCorners,
  	minimum height=\minimumRectangleHeight,
  	minimum width=\minimumRectangleWidth,
  	draw=black
		}
	]

% elements positions
% ------------------------------------------------

\tikzmath{
	% the absices
  \leftColumnAbs        = -4.5 mm;
  \rightColumnAbs       = -\leftColumnAbs;
  %
  % the ordinates
  \msrBookOrd             =  0 mm;
  \msrBookElementOrd      = \msrBookOrd -1 mm;
  %
  \msrScoreOrd            = -2 mm;
  %
  \msrPartGroupOrd        = -3 mm;
  \msrPartGroupElementOrd = \msrPartGroupOrd - 1 mm;
  %
  \msrPartOrd             = -5 mm;
  %
  \msrStaffOrd            = -6 mm;
  %
  \msrVoiceOrd            = -7 mm;
  \msrVoiceElementOrd     = \msrVoiceOrd - 1 mm;
  %
  \msrSegmentOrd          = -9 mm;
  \msrSegmentElementOrd   = \msrSegmentOrd - 1 mm;
  %
  \msrMeasureOrd          = -11 mm;
  \msrMeasureElementOrd   = \msrMeasureOrd - 1 mm;
  %
  \msrStanzaOrd       	= \msrVoiceOrd - 0.75 mm;
  \msrSyllableOrd       = \msrStanzaOrd - 1 mm;
  %
  \msrHarmonyOrd       	       = \msrMeasureElementOrd - 0.5 mm;
  \msrFiguredBassOrd    = \msrMeasureElementOrd - 1.5 mm;
  %
  \msrRepeatOrd       	       = \msrVoiceElementOrd - 0.75 mm;
  %
  \msrMultiMeasureRestOrd  = \msrSegmentElementOrd - 0.75 mm;
  \msrMeasureRepeatOrd         = \msrMultiMeasureRestOrd - 0.75 mm;
  \msrBeatRepeatOrd            = \msrMeasureRepeatOrd - 0.75 mm;
  %
  \otherMeasureElementsOrd  = \msrMeasureElementOrd - 1.5 mm;
  %
  \msrDoubleTremoloOrd      = \msrMeasureElementOrd - 2.5 mm;
  %
  \msrTupletElementAbs  = 0 mm;
	\msrTupletElementOrd  = \msrMeasureElementOrd - 2 mm;
%
  \msrTupletAbs         = - \rightColumnAbs * 0.6;
	\msrTupletOrd         = \msrTupletElementOrd - 1.25 mm;
%
  \msrGraceNotesGroupOrd = \msrTupletElementOrd - 2.5 mm;
  %
  \msrChordOrd          = \msrTupletElementOrd - 3.75 mm;
  \msrChordAbs          = - \leftColumnAbs * 0.6;
  %
  \msrNoteOrd            = \msrMeasureElementOrd - 7 mm;
	%
	\msrTupletToTupletExternalPointAbs = \msrTupletAbs - 1.75 mm;
  %
  \msrSyllableToNoteExternalPointAbs = \leftColumnAbs - 1.5 mm;
  \msrSyllableToNoteExternalPointOrd = \msrNoteOrd - 0.5 mm;
  %
  \msrHarmonyToNoteExternalPointAbs = \leftColumnAbs - 1 mm;
  \msrHarmonyToNoteExternalPointOrd = \msrNoteOrd + 0;
  %
  \msrFiguredBassToNoteExternalPointAbs = \leftColumnAbs - 0.5 mm;
  \msrFiguredBassToNoteExternalPointOrd = \msrNoteOrd + 0.5 mm;
  %
	\msrPartGroupToPartGroupExternalPointAbs = \msrPartGroupOrd - 0.25 mm;
	%
%	\msrNoteToMeasureExternalPointAbs = \msrChordAbs + 1.5 mm;
%	\msrNoteToMeasureExternalPointOrd = \msrChordOrd + 0.125 mm;
	%
	\msrNoteToTupletElementExternalPointAbs = \msrChordAbs + 1.5 mm;
	\msrNoteToTupletElementExternalPointOrd = \msrChordOrd + 0.125 mm;
	%
}



% The colors
% ------------------------------------------------

\def \SecondaryRectanglesBackgroundColor {pink!10}
\def \ElementsRectanglesBackgroundColor  {yellow!10}
\def \PrimaryRectanglesBackgroundColor   {green!7.5}
\def \RepeatRectanglesBackgroundColor    {orange!10}

\def \baseClassArcsColor {red}
\def \usedByClassArcsColor {blue}
\def \loopsColor {red}



% The coordinates
% ------------------------------------------------

\coordinate (msrBook)             at (0,\msrBookOrd);
\coordinate (msrBookElement)      at (0,\msrBookElementOrd);

\coordinate (msrScore)            at (0,\msrScoreOrd);

\coordinate (msrPartGroup)        at (0,\msrPartGroupOrd);
\coordinate (msrPartGroupElement) at (0,\msrPartGroupElementOrd);

\coordinate (msrPart)             at (0,\msrPartOrd);

\coordinate (msrStaff)            at (0,\msrStaffOrd);

\coordinate (msrVoice)            at (0,\msrVoiceOrd);
\coordinate (msrVoiceElement)     at (0,\msrVoiceElementOrd);

\coordinate (msrSegment)          at (0,\msrSegmentOrd);
\coordinate (msrSegmentElement)   at (0,\msrSegmentElementOrd);

\coordinate (msrMeasure)          at (0,\msrMeasureOrd);
\coordinate (msrMeasureElement)   at (0,\msrMeasureElementOrd);

\coordinate (msrStanza)           at (\leftColumnAbs,\msrStanzaOrd);

\coordinate (msrFiguredBass)      at (\leftColumnAbs,\msrFiguredBassOrd);
\coordinate (msrHarmony)          at (\leftColumnAbs,\msrHarmonyOrd);

\coordinate (msrSyllable)         at (\leftColumnAbs,\msrSyllableOrd);

\coordinate (msrRepeat)           at (\rightColumnAbs,\msrRepeatOrd);
\coordinate (msrMultiMeasureRest)     at (\rightColumnAbs,\msrMultiMeasureRestOrd);
\coordinate (msrMeasureRepeat)   at (\rightColumnAbs,\msrMeasureRepeatOrd);
\coordinate (msrBeatRepeat)      at (\rightColumnAbs,\msrBeatRepeatOrd);

\coordinate (msrTupletElement)    at (\msrTupletElementAbs,\msrTupletElementOrd);
\coordinate (msrTuplet)           at (\msrTupletAbs,\msrTupletOrd);

\coordinate (msrChord)            at (\msrChordAbs,\msrChordOrd);

\coordinate (msrGraceNotesGroup)  at (0,\msrGraceNotesGroupOrd);

\coordinate (msrNote)             at (0,\msrNoteOrd);

\coordinate (otherMeasureElements) at (\rightColumnAbs,\otherMeasureElementsOrd);

\coordinate (msrDoubleTremolo)     at (\rightColumnAbs,\msrDoubleTremoloOrd);

\coordinate (msrSyllableToNoteExternalPoint)       at (\msrSyllableToNoteExternalPointAbs,\msrSyllableToNoteExternalPointOrd);

\coordinate (msrHarmonyToNoteExternalPoint)        at (\msrHarmonyToNoteExternalPointAbs,\msrHarmonyToNoteExternalPointOrd);

\coordinate (msrFiguredBassToNoteExternalPoint)    at (\msrFiguredBassToNoteExternalPointAbs,\msrFiguredBassToNoteExternalPointOrd);

\coordinate (msrTupletToTupletExternalPoint)       at (\msrTupletToTupletExternalPointAbs,\msrTupletOrd);

\coordinate (msrPartGroupToPartGroupExternalPoint) at (\msrPartGroupToPartGroupExternalPointAbs,\msrPartGroupOrd);

\coordinate (msrNoteToTupletElementExternalPoint)  at (\msrNoteToTupletElementExternalPointAbs,\msrNoteToTupletElementExternalPointOrd);

%\coordinate (msrNoteToMeasureExternalPoint)        at (\msrNoteToMeasureExternalPointAbs,\msrNoteToMeasureExternalPointOrd);


%\node [draw= none] (caption) at (- 15 cm, 0) {\caption {The \msrRepr\ classes hierarchy}};


% Draw the nodes and arcs
% ------------------------------------------------

% msrNote
% ------------------------------------------------
% right now, otherwise the inward arrows tip go to the center of the msrNote node,
% because the former are drawn before the latter
\node [fill=\PrimaryRectanglesBackgroundColor]
  (msrNote) at (msrNote) {\texttt {\textbf {msrNote}}};


% msrBook and msrBookElement
% ------------------------------------------------
% before the downward links
\node [fill=\PrimaryRectanglesBackgroundColor]
  (msrBook) at (msrBook) {\texttt {\textbf {msrBook}}};


\node[fill=\ElementsRectanglesBackgroundColor]
  (msrBookElement) at (msrBookElement) {\texttt {msrBookElement}};

\path [->, thick, \usedByClassArcsColor]
  (msrBookElement)
  edge node [draw=none] {}
  (msrBook);

\path [->, thick, \baseClassArcsColor]
  (msrScore)
  edge node [draw=none] {}
  (msrBookElement);


% msrScore
% ------------------------------------------------
\node [fill=\PrimaryRectanglesBackgroundColor]
  (msrScore) at (msrScore) {\texttt {\textbf {msrScore}}};

\path [->, thick, \usedByClassArcsColor]
    (msrPartGroup)
    edge node [draw=none] {}
    (msrScore);


% msrPartGroupElement and msrPartGroup
% ------------------------------------------------
% before the downward links
\node [fill=\PrimaryRectanglesBackgroundColor]
  (msrPartGroup) at (msrPartGroup) {\texttt {\textbf {msrPartGroup}}};

\node [fill=\ElementsRectanglesBackgroundColor]
  (msrPartGroupElement) at (msrPartGroupElement) {\texttt {msrPartGroupElement}};

\path [->, thick, \usedByClassArcsColor]
  (msrPartGroupElement)
  edge node [draw=none] {}
  (msrPartGroup);

\path [->, thick, \baseClassArcsColor]
  (msrPartGroupElement)
  edge node [draw=none] {}
  (msrPart);

\draw [->, thick, \baseClassArcsColor]
	(msrPartGroup)
	.. controls +(160:7.5 cm) and +(200:7.5 cm) ..
  (msrPartGroupElement);


% msrPart
% ------------------------------------------------
\node[fill=\PrimaryRectanglesBackgroundColor]
  (msrPart) at (msrPart) {\texttt {\textbf {msrPart}}};

\path [->, thick, \baseClassArcsColor]
  (msrPart)
  edge node [draw=none] {}
  (msrPartGroupElement);

\path [->, thick, \usedByClassArcsColor]
  (msrStaff)
   edge node [draw=none] {}
  (msrPart);


% msrStaff
% ------------------------------------------------
\node [fill=\PrimaryRectanglesBackgroundColor]
  (msrStaff) at (msrStaff) {\texttt {\textbf {msrStaff}}};

\path [->, thick, \usedByClassArcsColor]
  (msrVoice)
  edge node [draw=none] {}
  (msrStaff);


% msrVoice and msrVoiceElement
% ------------------------------------------------
\node [fill=\PrimaryRectanglesBackgroundColor]
  (msrVoice) at (msrVoice) {\texttt {\textbf {msrVoice}}};

\node [fill=\ElementsRectanglesBackgroundColor]
  (msrVoiceElement) at (msrVoiceElement) {\texttt {msrVoiceElement}};

\path [->, thick, \usedByClassArcsColor]
	(msrVoiceElement)
  edge node [draw=none] {}
	(msrVoice);

\path [->, thick, \baseClassArcsColor]
	(msrSegment)
  edge node [draw=none] {}
	(msrVoiceElement);


% msrSegment and msrSegmentElement
% ------------------------------------------------
\node [fill=\SecondaryRectanglesBackgroundColor]
  (msrSegment) at (msrSegment) {\texttt {msrSegment}};

\node [fill=\ElementsRectanglesBackgroundColor]
  (msrSegmentElement) at (msrSegmentElement) {\texttt {msrSegmentElement}};

\path [->, thick, \usedByClassArcsColor]
	(msrSegmentElement)
  edge node [draw=none] {}
	(msrSegment);

\path [->, thick, \baseClassArcsColor]
	(msrSegment)
  edge node [draw=none] {}
	(msrVoiceElement);


% msrMeasure and msrMeasureElement
% ------------------------------------------------
\node [fill=\PrimaryRectanglesBackgroundColor]
  (msrMeasure) at (msrMeasure) {\texttt {\textbf {msrMeasure}}};

\node [fill=\ElementsRectanglesBackgroundColor]
  (msrMeasureElement) at (msrMeasureElement) {\texttt {msrMeasureElement}};

\path [->, thick, \usedByClassArcsColor]
	(msrMeasureElement)
  edge node [draw=none] {}
	(msrMeasure);

\path [->, thick, \baseClassArcsColor]
	(msrMeasure)
  edge node [draw=none] {}
	(msrSegmentElement);


% msrStanza
% ------------------------------------------------
\node [fill=\PrimaryRectanglesBackgroundColor]
  (msrStanza) at (msrStanza) {\texttt {\textbf {msrStanza}}};

\draw [->, thick, \usedByClassArcsColor]
	(msrStanza)
	.. controls +(5:3 cm) and +(205:4 cm) ..
  (msrVoice);

% msrSyllable
% ------------------------------------------------
\node [fill=\SecondaryRectanglesBackgroundColor]
  (msrSyllable) at (msrSyllable) {\texttt {msrSyllable}};

\path [->, thick, \baseClassArcsColor]
	(msrSyllable)
  edge node [draw=none] {}
	(msrMeasureElement);

\path [->, thick, \baseClassArcsColor]
	(msrSyllable)
	.. controls +(270:4 cm) and +(185:4 cm) .. % JMI
	(msrMeasureElement);

\path [->, thick, \usedByClassArcsColor]
	(msrSyllable)
  edge node [draw=none] {}
	(msrStanza);

\draw [->, thick, \usedByClassArcsColor]
	(msrSyllable)
	.. controls +(195:10 cm) and +(130:6.5 cm) ..
  (msrSyllableToNoteExternalPoint);

\draw [->, thick, \usedByClassArcsColor]
	(msrSyllableToNoteExternalPoint)
	.. controls +(310:6 cm) and +(270:4 cm) ..
  (msrNote);



% msrRepeat
% ------------------------------------------------
\node [fill=\RepeatRectanglesBackgroundColor]
  (msrRepeat) at (msrRepeat) {\texttt {\textbf {msrRepeat}}};

\draw [->, thick, \baseClassArcsColor]
	(msrRepeat)
	.. controls +(170:3 cm) and +(337.5:6 cm) ..
  (msrVoiceElement);



% msrMultiMeasureRest
% ------------------------------------------------
\node [fill=\RepeatRectanglesBackgroundColor]
  (msrMultiMeasureRest) at (msrMultiMeasureRest) {\texttt {\textbf {msrMultiMeasureRest}}};

\draw [->, thick, \baseClassArcsColor]
	(msrMultiMeasureRest)
	.. controls +(170:5 cm) and +(330:3 cm) ..
  (msrSegmentElement);

% msrMeasureRepeat
% ------------------------------------------------
\node [fill=\RepeatRectanglesBackgroundColor]
    (msrMeasureRepeat) at (msrMeasureRepeat) {\texttt {\textbf {msrMeasureRepeat}}};

\draw [->, thick, \baseClassArcsColor]
	(msrMeasureRepeat)
	.. controls +(170:5 cm) and +(320:3 cm) ..
  (msrSegmentElement);

% msrBeatRepeat
% ------------------------------------------------
\node [fill=\RepeatRectanglesBackgroundColor]
  (msrBeatRepeat) at (msrBeatRepeat) {\texttt {\textbf {msrBeatRepeat}}};

\draw [->, thick, \baseClassArcsColor]
	(msrBeatRepeat)
	.. controls +(170:5 cm) and +(305:6 cm) ..
  (msrSegmentElement);



% msrHarmony
% ------------------------------------------------
\node [fill=\PrimaryRectanglesBackgroundColor]
  (msrHarmony) at (msrHarmony) {\texttt {\textbf {msrHarmony}}};

\draw [->, thick, \baseClassArcsColor]
	(msrHarmony)
	.. controls +(5:7 cm) and +(190:6.5 cm) ..
  (msrMeasureElement);

\draw [->, thick, \usedByClassArcsColor]
	(msrHarmony)
	.. controls +(195:7 cm) and +(130:4 cm) ..
  (msrHarmonyToNoteExternalPoint);

\draw [->, thick, \usedByClassArcsColor]
	(msrHarmonyToNoteExternalPoint)
	.. controls +(310:5 cm) and +(230:4.5 cm) ..
  (msrNote);



% msrFiguredBass
% ------------------------------------------------
\node [fill=\PrimaryRectanglesBackgroundColor]
  (msrFiguredBass) at (msrFiguredBass) {\texttt {\textbf {msrFiguredBass}}};

\draw [->, thick, \baseClassArcsColor]
	(msrFiguredBass)
	.. controls +(15:6 cm) and +(210:5 cm) ..
  (msrMeasureElement);

\draw [->, thick, \usedByClassArcsColor]
	(msrFiguredBass)
	.. controls +(210:5 cm) and +(130:3 cm) ..
  (msrFiguredBassToNoteExternalPoint);

\draw [->, thick, \usedByClassArcsColor]
	(msrFiguredBassToNoteExternalPoint)
	.. controls +(310:6 cm) and +(210:3 cm) ..
  (msrNote);



% otherMeasureElements
% ------------------------------------------------
\node [fill=\PrimaryRectanglesBackgroundColor]
  (otherMeasureElements) at (otherMeasureElements) {\textbf {other measure elements\dots}};

\draw [->, thick, \baseClassArcsColor]
	(otherMeasureElements)
	.. controls +(175:6 cm) and +(335:5) ..
  (msrMeasureElement);



% msrDoubleTremolo
% ------------------------------------------------
\node [fill=\PrimaryRectanglesBackgroundColor]
  (msrDoubleTremolo) at (msrDoubleTremolo) {\texttt {\textbf {msrDoubleTremolo}}};

\draw [->, thick, \baseClassArcsColor]
	(msrDoubleTremolo)
	.. controls +(170:6 cm) and +(320:3) ..
  (msrMeasureElement);



% msrGraceNotesGroup
% ------------------------------------------------
\node [fill=\PrimaryRectanglesBackgroundColor]
  (msrGraceNotesGroup) at (msrGraceNotesGroup) {\texttt {\textbf {msrGraceNotesGroup}}};

\draw [->, thick, \usedByClassArcsColor]
	(msrGraceNotesGroup)
	.. controls +(195:4.5 cm) and +(160:4) ..
  (msrNote);



% msrTuplet and msrTupletElement
% ------------------------------------------------
% before the downward links
\node [fill=\PrimaryRectanglesBackgroundColor]
  (msrTuplet) at (msrTuplet) {\texttt {\textbf {msrTuplet}}};

\node [fill=\ElementsRectanglesBackgroundColor]
  (msrTupletElement) at (msrTupletElement) {\texttt {msrTupletElement}};

\draw [->, thick, \usedByClassArcsColor]
	(msrTupletElement)
	.. controls +(185:4 cm) and +(160:7 cm) ..
  (msrTuplet);

\draw [->, thick, \baseClassArcsColor]
	(msrTupletElement)
  edge node [draw=none] {}
  (msrMeasureElement);

\draw [->, thick, \baseClassArcsColor]
	(msrTuplet)
  edge node [draw=none] {}
  (msrTupletElement);

\draw [->, thick, \usedByClassArcsColor]
	(msrTuplet)
	.. controls +(185:7 cm) and +(190:10 cm) ..
  (msrGraceNotesGroup);



% msrChord
% ------------------------------------------------
\node [fill=\PrimaryRectanglesBackgroundColor]
  (msrChord) at (msrChord) {\texttt {\textbf {msrChord}}};

\draw [->, thick, \baseClassArcsColor]
	(msrChord)
	.. controls +(90:6 cm) and +(330:7 cm) ..
  (msrTupletElement);

\draw [->, thick, \usedByClassArcsColor]
	(msrChord)
	.. controls +(130:2.5 cm) and +(315:3) ..
  (msrGraceNotesGroup);



% msrNote
% ------------------------------------------------
\draw [->, thick, \usedByClassArcsColor]
	(msrNote)
	edge node [draw=none] {}
  (msrGraceNotesGroup);

\draw [->, thick, \usedByClassArcsColor]
	(msrNote)
	.. controls +(20:4 cm) and +(220:3 cm) ..
  (msrChord);

\draw [->, thick, \baseClassArcsColor]
	(msrNote)
	.. controls +(5:6.5 cm) and +(270:3 cm) ..
  (msrNoteToTupletElementExternalPoint);

\draw [->, thick, \baseClassArcsColor]
	(msrNoteToTupletElementExternalPoint)
	.. controls +(90:3 cm) and +(345:10 cm) ..
  (msrTupletElement);

%\draw [->, thick, \baseClassArcsColor]
%	(msrNote)
%	.. controls +(5:6.5 cm) and +(270:3 cm) ..
%  (msrNoteToMeasureExternalPoint);
%
%\draw [->, thick, \baseClassArcsColor]
%	(msrNoteToMeasureExternalPoint)
%	.. controls +(90:3 cm) and +(320:2 cm) ..
%  (msrMeasureElement);

\draw [->, thick, \usedByClassArcsColor]
	(msrNote)
	.. controls +(355:18 cm) and +(315:3 cm) ..
  (msrDoubleTremolo);


% -------------------------------------------------------------------------
\end{tikzpicture}
 % -------------------------------------------------------------------------

\end{center}

\end{figure}
\end{adjustwidth}

