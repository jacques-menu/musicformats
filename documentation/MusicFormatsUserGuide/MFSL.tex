% !TEX root = MusicFormatsUserGuide.tex

% -------------------------------------------------------------------------
\chapter{MFSL (MusicFormats Scripting Language}
% -------------------------------------------------------------------------

\mfslLang\ is meant for launching \mf\ tools easily, with options and control structures. Its syntax and semantics are very simple, for use by musicians.

The main features of \mfslLang\ are:
\begin{itemize}
\item the options are written the same as in OAH, such as \code {-global-staff-size 25.5};

\item the numbers and strings in options values are written the same as in OAH too;

\item the keywords are very few: \code{tool}, \code{input}, \code{choice}, \code{set} and \code{case};
\end{itemize}

An \MainIt{interpreter} is provided by \mf\, that can run \mfslLang\ \script s as in done by the usual shells:
\begin{lstlisting}[language=Terminal]
jacquesmenu@macmini > mfsl -about
What mfsl does:

    This interpreter basically reads a text file containing
    a tool name, an input file name, keywords and options,
    and launches the specified tool
    with these options applied to the input file name.

    The activity log and warning/error messages go to standard error.
\end{lstlisting}


% -------------------------------------------------------------------------
\section{A first, minimal script example}
% -------------------------------------------------------------------------

The \optionNameBoth{no-launch}{nl} option to \mfslI\ has an option to display the essential information found in the script and quit without acutally running the tool:
\begin{lstlisting}[language=Terminal]

\end{lstlisting}

This \script\ illustrates the basic features of \mfslLang:
\begin{lstlisting}[language=MFSL]
jacquesmenu@macmini: ~/musicformats-git-dev/files/mfslfiles > ./minimal.mfsl -no-launch
====> The known tools names are: ["msdlconverter", "xml2brl", "xml2gmn", "xml2ly" and "xml2xml"]"
====> tool xml2ly
====> input: Hymn121.xml
====> Launching  tool xml2ly
====> The command to be executed is:
  xml2ly Hymn121.xml
====> The command above is *not* executed
\end{lstlisting}

This first line of an \mfslLang\ \script is \MainIt{shebang} containing the \filePath\ to the interpreter, allow for running such \script s by their name provided they are made executable.


% -------------------------------------------------------------------------
\section{Scripts structure}
% -------------------------------------------------------------------------

An MFSL script basically contains:
\begin{itemize}
\item a tool specification, telling which MusicFormats tool
    to use, here xml2ly;

\item  an input specification, the input source to apply
    the latter to, here file name "Hymn121.xml".
\end{itemize}

Such a script is meant to collect options to launch the tool
with the input specification as input.

There an thus be:
\begin{itemize}
\item  any number of MusicFormats options;

\item  choices specifications, to provide options selection criteria.

%\item a 'set' specification to choose one such SCORE among the possible ones;

\item 'case' specifications stating the options to be used depending on
  the choices values;

\item optionnaly, an 'only' or 'all' specification.

\end{itemize}


% -------------------------------------------------------------------------
\section{Options to the MFSL parser}
% -------------------------------------------------------------------------

These specific options are:
\begin{lstlisting}[language=Terminal]
jacquesmenu@macmini: ~/musicformats-git-dev/src/interpreters/mfsl > mfsl  -insider -help-mfsl-interpreter-group
--- Help for group "mfsl" ---
  mfsl (-help-mfsl-interpreter-group, -hmi-group):
    These options control the way MFSL interpreter works.
  --------------------------
    MFSL    (-help-mfsl, -hmfsl):
      -verbose-mode, -verbose
            Don't execute the MFSL input, merely display the tokens it contains.
      -trace-scanning, -tscan
            Write a trace of the MFSL scanning activity to standard error.
      -trace-parsing, -tparse
            Write a trace of the MFSL parsing activity to standard error.
      -display-tokens, -dtoks
            Display the MFSL tokens after they are accepted.
      -display-non-terminals, -dnterms
            Display the MFSL non-terminals after they are accepted.
\end{lstlisting}


% -------------------------------------------------------------------------
\section{Running the example MFSL script}
% -------------------------------------------------------------------------

Let's show show the \mfslLangInterp\ uses the options above:
\begin{lstlisting}[language=Terminal]
jacquesmenu@macmini: ~/musicformats-git-dev/src/interpreters/mfsl > ./test.mfsl -display-tokens -display-non-terminals -display-options-values
  The options values for //Users/jacquesmenu/musicformats-git-dev/build/bin/mfsl are:
    MFSL group (-help-mfsl-group, -hmfsl-group), 2 atoms chosen:
    --------------------------
      MFSL (-help-mfsl, -hmfsl), 2 atoms chosen:
        fTraceTokens                     : true, set by user
        fDisplayNonTerminals               : true, set by user

    Options and help group (-help-oah-group, -hoah-group), 1 atom chosen:
    --------------------------
      Options and help (-help-oah, -hoah), 1 atom chosen:
        fDisplayOptionsValues              : true, set by user


--> ./test.mfsl:2.1-39: tool
--> ./test.mfsl:2.41: :
--> ./test.mfsl:2.43-48: name [xml2ly]
  ==> tool: xml2ly

--> ./test.mfsl:4.1-22: input
--> ./test.mfsl:4.24: :
--> ./test.mfsl:4.25-33: name [test.mfsl]
  ==> input: test.mfsl

--> test.mfsl:6.11-32: option [-keep-musicxml-part-id]
--> test.mfsl:6.34-35: name [P1]
  ==> option -keep-musicxml-part-id P1

--> test.mfsl:8.1-26: choice
--> test.mfsl:8.28-40: name [VOICES_CHOICE]
--> test.mfsl:8.42: :
--> test.mfsl:8.44-53: name [voice1Only]
--> test.mfsl:8.55: |
--> test.mfsl:8.57-66: name [voice2Only]
--> test.mfsl:8.68: ;
  ==> ChoiceDeclaration VOICES_CHOICE : ...

--> test.mfsl:10.1-3: set
--> test.mfsl:10.5-17: name [VOICES_CHOICE]
--> test.mfsl:10.19: =
--> test.mfsl:10.21-30: name [voice1Only]
--> test.mfsl:10.32: ;
  ==> ChoiceSetting, set VOICES_CHOICE = voice1Only

--> test.mfsl:12.1-61: case
--> test.mfsl:12.63-75: name [VOICES_CHOICE]
--> test.mfsl:12.77: :
--> test.mfsl:13.2-11: name [voice1Only]
--> test.mfsl:13.12: :
--> test.mfsl:14.5-10: option [-title]
--> test.mfsl:14.12-34: double quoted string ["]
  ==> option -title "

--> test.mfsl:15.5-21: option [-ignore-msr-voice]
--> test.mfsl:15.23-51: name [Part_POne_Staff_One_Voice_Two]
  ==> option -ignore-msr-voice Part_POne_Staff_One_Voice_Two

--> test.mfsl:16.3: ;
  ==> Case voice1Only : ...

--> test.mfsl:18.2-11: name [voice2Only]
--> test.mfsl:18.12: :
--> test.mfsl:19.5-10: option [-title]
--> test.mfsl:19.12-34: double quoted string ["]
  ==> option -title "

--> test.mfsl:20.5-22: option [--ignore-msr-voice]
--> test.mfsl:20.24-52: name [Part_POne_Staff_One_Voice_One]
  ==> option --ignore-msr-voice Part_POne_Staff_One_Voice_One

--> test.mfsl:22.5-27: option [-display-options-values]
--> test.mfsl:24.5-22: option [-global-staff-size]
  ==> option -display-options-values

--> test.mfsl:24.24-27 double: 25.5
  ==> option -global-staff-size 25.5

--> test.mfsl:25.3: ;
  ==> Case voice2Only : ...

--> test.mfsl:26.1: ;
  ==> CaseStatement, VOICES_CHOICE : ...

--> parseResult: 0
==> inputFileName: test.mfsl
==> toolName:      xml2ly
jacquesmenu@macmini: ~/musicformats-git-dev/src/interpreters/mfsl >
\end{lstlisting}

